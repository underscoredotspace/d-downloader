#!/usr/bin/perl

$spec_addr = "http://dilbert.com/strips/comic/" . $ARGV[0] . "-" . $ARGV[1] . "-" . $ARGV[2] . "/";
$folder = $ARGV[0] . "/" . $ARGV[1] . "/";
$filename = $ARGV[2] . "z.";

$user_agent = "-A \"Mozilla/5.0 (Macintosh; U; Intel Mac OS X; en-us) AppleWebKit/523.10.6 (KHTML, like Gecko) Version/3.0.4 Safari/523.10.6\"";

$rootpath = "/home/operator11/dilbert/";

$dilbert = readpipe "usewithtor curl --silent " . $user_agent . " " .  $spec_addr ;

$dilbert =~ /(\/dyn.+zoom.(jpg|gif))/;
$getfile = $1; $ext = $2;

$dum = system("mkdir -p " . $rootpath . $folder);
$dum = system("usewithtor curl " . $user_agent . " --silent --output " . $rootpath . $folder . $filename . $ext . " http://dilbert.com" . $getfile);

$dum = system("ln -s " . $rootpath . $folder . $filename . $ext . " " . $rootpath . "today");
